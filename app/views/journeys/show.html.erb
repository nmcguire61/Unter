<div class="journeys">
  <table>
    <thead>
      <tbody>
        <tr>
          <th>From:</th>
          <th>To:</th>
          <th>Travel Date/Time:</th>
          <th>Driver:</th>
          <th>Car:</strong></th>
          <th>Number of seats:</th>
          <th>Status:</th>
</tr>
<tr>
          <td><%= @journey.starting_point %></td>
          <td><%= @journey.ending_point %></td>
          <td><%= @journey.human_readable_time %></td>
          <td><%= @journey.user.name %></td>
          <td><%= @journey.car.brand %></td>
          <td><%= @journey.car.seats %></td>
          <td><%= @journey.status %></td>

        </tr>
      </tbody>
    </thead>
  </table>

  <% @journey.passengers.each do |p| %>
  <% status = p.status %>
  <% if status == 'Accepted' %>
  <%= p.user.name %> is accepted!
  <% elsif status == 'Rejected' %>
  <%= p.user.name %> is rejected!
  <% else %>
  <% if @journey.driver.user_id == current_user.id %>
  <%= p.user.name %><%= p.price %><%= p.status %>
  <%= button_to "Accept", journey_passenger_accept_path(@journey, p) %>
  <%= button_to "Reject", journey_passenger_reject_path(@journey, p) %>
  <% else %>
  <%= p.user.name %><%= p.price %><%= p.status %>
  <% end %>
  <% end %>
  <% end %>

  <% if @journey.full?  %>
  The journey is full!
  <% else %>
  <% if @journey.passengers.any? {|p| p[:user_id] == current_user.id} %>
  <strong>You already joined this journey!</strong>
  <% else %>
  
  <%= link_to "Join as a passenger", new_journey_passenger_path(@journey), :class=> "btn btn-reverse" %>
  <% end %>
  <% end %>

  <%# @journey.passengers.each { |p| @journey.send_message(p.user, "#{@journey.starting_point} - #{@journey.ending_point}", "Journey is closed")} %>



  <%= link_to 'Back', journeys_path, :class=> "back" %>

</div>
